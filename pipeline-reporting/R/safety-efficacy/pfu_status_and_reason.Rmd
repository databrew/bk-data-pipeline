---
title: "PFU Report"
output: 
  html_document:
    toc: true
    toc_float: 
      collapsed: true
    theme: cerulean
date: '`r Sys.time()`'
---

Notes:

- Report is refreshed hourly 9-5pm EAT, once 12AM EAT
- Please reach out to nikamgorski@gmail.com for bug reports


```{r, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
  comment = '', 
  echo = FALSE,
  message = FALSE,
  cache=FALSE,
  warning=FALSE
)
```

```{r setup, include=FALSE}
### PURPOSE:
# determine how many woman had submissions for PFU; enter only as in and only thing that can happen is become EOS.

# load required libraries
library(dplyr)
library(reactable)
library(data.table)
library(cloudbrewr)
library(fontawesome)
library(shiny)
library(ggplot2)
library(tidyr)

ENV_PIPELINE_STAGE <- Sys.getenv("PIPELINE_STAGE")
DATA_STAGING_BUCKET_NAME <- 'databrew.org'
DATA_LAKE_BUCKET_NAME <- 'bohemia-lake-db'
PROJECT_SOURCE <- 'kwale'
SE_FOLDER_TARGET <- glue::glue('{PROJECT_SOURCE}/clean-form')

pad_hhid <- function(data){
  if('hhid' %in% names(data)){
    data %>%
      dplyr::mutate(hhid = stringr::str_pad(hhid, 5, pad = "0"))
  }else{
    data
  }
}


tryCatch({
  logger::log_info('Attempt AWS login')
  # login to AWS - this will be bypassed if executed in CI/CD environment
  cloudbrewr::aws_login(
    role_name = 'cloudbrewr-aws-role',
    profile_name =  'cloudbrewr-aws-role',
    pipeline_stage = ENV_PIPELINE_STAGE)

}, error = function(e){
  logger::log_error('AWS Login Failed')
  stop(e$message)
})


# load in the data
assignment <- cloudbrewr::aws_s3_get_table(
  bucket ='bohemia-lake-db',
  key = 'bohemia_ext_data/assignments/assignments.csv') %>%
  pad_hhid() %>%
  rename(cluster = cluster_number)

pfu <- cloudbrewr::aws_s3_get_table(
  bucket = DATA_STAGING_BUCKET_NAME,
  key = glue::glue('{PROJECT_SOURCE}/clean-form/pfu/pfu.csv')) %>%
  pad_hhid()

pfu_repeat <- cloudbrewr::aws_s3_get_table(
  bucket = DATA_STAGING_BUCKET_NAME,
  key = glue::glue('{PROJECT_SOURCE}/clean-form/pfu/pfu-repeat_preg_symptom.csv')) %>%
  pad_hhid()

v0_dem_repeat <- cloudbrewr::aws_s3_get_table(
    bucket = DATA_STAGING_BUCKET_NAME,
    key = glue::glue('{PROJECT_SOURCE}/clean-form/v0demography/v0demography-repeat_individual.csv')) %>%
    pad_hhid()

v0_demography <- cloudbrewr::aws_s3_get_table(
    bucket = DATA_STAGING_BUCKET_NAME,
    key = glue::glue('{PROJECT_SOURCE}/clean-form/v0demography/v0demography.csv')) %>%
    pad_hhid()

pfu_targets <- cloudbrewr::aws_s3_get_table(
  bucket ='bohemia-lake-db',
  key = glue::glue('bohemia_prod/dwh/goal_pfu_targets/goal_pfu_targets.csv')) %>%
  pad_hhid()

pkfollowup <- cloudbrewr::aws_s3_get_table(
  bucket = DATA_STAGING_BUCKET_NAME,
  key = glue::glue('{PROJECT_SOURCE}/clean-form/pkfollowup/pkfollowup.csv')) %>%
  pad_hhid()

# this is a function to create a download csv button
wrap_download <- function(reactable_obj, element_id, output_filename){
  onclick_command <- glue::glue(
    "Reactable.downloadDataCSV('{element_id}', '{output_filename}')")
  htmltools::browsable(
    tagList(
      tags$button(
        tagList(fontawesome::fa("download"), "Download as CSV"),
        onclick = onclick_command),
      reactable_obj
    ))
}
```

```{r data creation}
# create the merged v0 data
  v0dem <- left_join(v0_dem_repeat, v0_demography, by=c('PARENT_KEY' = 'KEY'))  %>%
    select(extid, dob, sex, todays_date) %>%
    rename(dob_v0 = dob,
           todays_date_v0 = todays_date,
           sex_v0 = sex)

  pk_pregnancies <- pkfollowup %>%
    select(extid, pregnancy_status) %>%
    filter(pregnancy_status == 'in')
  # 2 extids (35022-02, 01024-02) found to be pregnant in pkfollowup must be enrolled in pfu

# assign the reasons for eos and in
pfu_enrolment <- pfu %>%
  arrange(visit) %>%
  group_by(extid) %>%
  mutate(enrolment = ifelse(row_number() == 1, "enrolment", "follow up")) %>%
  ungroup()

pfu_reason <- pfu_enrolment %>%
  mutate(pregnancy_status_reason = case_when(pregnancy_status == 'in' ~ 'in',
                            ltfu_eos == '1' |
                              fourth_absence_eos == '1' ~ 'absent 4 times in a row: ltfu',
                            person_died_eos == '1' ~ 'died',
                            person_migrated_eos == '1' ~ 'migrated',
                            not_continue_eos == '1' ~ 'not wish to continue',
                            #still_preg_no_eos == '1' ~ 'no longer pregnant',
                            still_preg_no_eos == '1' & 
                              still_preg_no_reason == 'Baby was born alive' ~ 'no longer pregnant - baby born alive',
                            still_preg_no_eos == '1' &
                              still_preg_no_reason == 'Miscarriage' ~ 'no longer pregnant - miscarriage',
                            still_preg_no_eos == '1' &
                              still_preg_no_reason == 'Abortion (self-induced)' ~ 'no longer pregnant - abortion (self-induced)',
                            still_preg_no_eos == '1' &
                              still_preg_no_reason == 'Baby was born dead' ~ 'no longer pregnant - baby was born dead',
                            still_preg_no_eos == '1' &
                              still_preg_no_reason == 'pna' ~ 'no longer pregnant - prefer not to answer')) %>%
  rename(dob_pregnancy = dob_string,
         sex_pregnancy = sex,
         todays_date_pregnancy = todays_date)
    

# create the dataset that will be used for this script
  # this will exclude the people who were manually removed
  data <- merge(pfu_reason, v0dem, by = c('extid'), all = TRUE) %>% 
    left_join(assignment, by='cluster')
  
# create the dataset for the extid explorer
  data_investigation <- data %>%
    filter(!is.na(visit)) %>% # removes extids not in Efficacy
    select(visit, extid, pregnancy_status, pregnancy_status_reason, enrolment,
           sex_v0, sex_pregnancy, dob_v0, dob_pregnancy, todays_date_v0,
           todays_date_pregnancy, assignment)
  
  # a trial profile tracks where every person went
  by_visit <- pfu_reason %>%
    pivot_wider(id_cols = c(extid, hhid, cluster), 
                names_from = visit,
                values_from = c(pregnancy_status, pregnancy_status_reason)) %>%
    dplyr::select(extid, hhid, pregnancy_status_V2,
                  pregnancy_status_V3, pregnancy_status_V4, pregnancy_status_V5, 
                  pregnancy_status_V6, pregnancy_status_V7, 
                  pregnancy_status_V8, pregnancy_status_V9, pregnancy_status_V10,
                  pregnancy_status_V11, pregnancy_status_reason_V2, 
                  pregnancy_status_reason_V3, pregnancy_status_reason_V4, 
                  pregnancy_status_reason_V5, 
                  pregnancy_status_reason_V6, 
                  pregnancy_status_reason_V7,
                  pregnancy_status_reason_V8, pregnancy_status_reason_V9,
                  pregnancy_status_reason_V10, pregnancy_status_reason_V11, cluster) %>%
    rename(status_V2 = pregnancy_status_V2,
           status_V3 = pregnancy_status_V3,
           status_V4 = pregnancy_status_V4,
           status_V5 = pregnancy_status_V5,
           status_V6 = pregnancy_status_V6,
           status_V7 = pregnancy_status_V7,
           status_V8 = pregnancy_status_V8,
           status_V9 = pregnancy_status_V9,
           status_V10 = pregnancy_status_V10,
           status_V11 = pregnancy_status_V11,
           reason_V2 = pregnancy_status_reason_V2,
           reason_V3 = pregnancy_status_reason_V3,
           reason_V4 = pregnancy_status_reason_V4,
           reason_V5 = pregnancy_status_reason_V5,
           reason_V6 = pregnancy_status_reason_V6,
           reason_V7 = pregnancy_status_reason_V7,
           reason_V8 = pregnancy_status_reason_V8,
           reason_V9 = pregnancy_status_reason_V9,
           reason_V10 = pregnancy_status_reason_V10,
           reason_V11 = pregnancy_status_reason_V11)

```

```{r targets}
# these numbers are determined by Aryton based on Joe's logic and are stored in AWS
  target_table <- pfu_targets %>%
    group_by(visit) %>%
    summarise(hh_target = sum(hh_target),
              ind_target = sum(ind_target))

# identify how many households were visited in V1 and V2
visited <- pfu %>%
  group_by(visit) %>%
  summarise(hh_visited = n_distinct(hhid),
            ind_visited = n_distinct(extid))

# join the number of households visited and targets
target_table <- left_join(target_table, visited, by = c('visit'))

target_table <- target_table %>%
  select(visit, ind_target, ind_visited, hh_target, hh_visited) %>%
  rename(Visit = visit,
         'Individual target' = ind_target,
         'Individual visited' = ind_visited,
         'HH target' = hh_target,
         'HH visited' = hh_visited)
```

```{r status}
# make a table of the number of women in, eos, and total visited for each visit

## V2 ###############
  pfu_v2 <- pfu %>%
    filter(visit == 'V2') 
  
  # change Status from logical to character
  pfu_v2$Status <- as.character(pfu_v2$Status)

  pfu_totals_v2 <- pfu_v2 %>%
      group_by(pregnancy_status) %>%
      summarise('number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'number of people visited' = sum(.$'number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`number of people visited`)) / as.numeric(nrow(pfu_v2)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  
## V3 ########################
  pfu_v3 <- pfu %>%
    filter(visit == 'V3') 

  # change Status from logical to character
  pfu_v3$Status <- as.character(pfu_v3$Status)

  pfu_totals_v3 <- pfu_v3 %>%
      group_by(pregnancy_status) %>%
      summarise('number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'number of people visited' = sum(.$'number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`number of people visited`)) / as.numeric(nrow(pfu_v3)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  
## V4 ########################
  pfu_v4 <- pfu %>%
    filter(visit == 'V4') 

  # change Status from logical to character
  pfu_v4$Status <- as.character(pfu_v4$Status)

  pfu_totals_v4 <- pfu_v4 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v4)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  
## V5 ########################
  pfu_v5 <- pfu %>%
    filter(visit == 'V5') 

  # change Status from logical to character
  pfu_v5$Status <- as.character(pfu_v5$Status)

  pfu_totals_v5 <- pfu_v5 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v5)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  
## V6 ########################
  pfu_v6 <- pfu %>%
    filter(visit == 'V6') 

  # change Status from logical to character
  pfu_v6$Status <- as.character(pfu_v6$Status)

  pfu_totals_v6 <- pfu_v6 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v6)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  
## V7 ########################
  pfu_v7 <- pfu %>%
    filter(visit == 'V7') 

  # change Status from logical to character
  pfu_v7$Status <- as.character(pfu_v7$Status)

  pfu_totals_v7 <- pfu_v7 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v7)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
## V8 ########################
  pfu_v8 <- pfu %>%
    filter(visit == 'V8') 

  # change Status from logical to character
  pfu_v8$Status <- as.character(pfu_v8$Status)

  pfu_totals_v8 <- pfu_v8 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v8)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
## V9 ########################
  pfu_v9 <- pfu %>%
    filter(visit == 'V9') 

  # change Status from logical to character
  pfu_v9$Status <- as.character(pfu_v9$Status)

  pfu_totals_v9 <- pfu_v9 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v9)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))


  ## V10 ########################
  pfu_v10 <- pfu %>%
    filter(visit == 'V10') 

  # change Status from logical to character
  pfu_v10$Status <- as.character(pfu_v10$Status)

  pfu_totals_v10 <- pfu_v10 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v10)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))
  
  ## V11 ########################
  pfu_v11 <- pfu %>%
    filter(visit == 'V11') 

  # change Status from logical to character
  pfu_v11$Status <- as.character(pfu_v11$Status)

  pfu_totals_v11 <- pfu_v11 %>%
      group_by(pregnancy_status) %>%
      summarise('Number of people visited' = n()) %>%
      arrange(pregnancy_status) %>%
      rename('PFU status' = pregnancy_status) %>%
      add_row('PFU status' = 'total people visited', 
              'Number of people visited' = sum(.$'Number of people visited')) %>%
      mutate('Percent complete' = (as.numeric(`Number of people visited`)) / as.numeric(nrow(pfu_v11)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%'))


```

```{r enrolment_followup}
## create tables to show how many are enrolment or follow up

## V2 ##########################

pregnancy_v2 <- data %>%
    filter(visit == 'V2')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v2 <- pregnancy_v2 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v2)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
## V3 ##########################

pregnancy_v3 <- data %>%
    filter(visit == 'V3')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v3 <- pregnancy_v3 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v3)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA


## V4 ##########################

pregnancy_v4 <- data %>%
    filter(visit == 'V4')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v4 <- pregnancy_v4 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v4)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
## V5 ##########################

pregnancy_v5 <- data %>%
    filter(visit == 'V5')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v5 <- pregnancy_v5 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v5)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
## V6 ##########################

pregnancy_v6 <- data %>%
    filter(visit == 'V6')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v6 <- pregnancy_v6 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v6)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
## V7 ##########################

pregnancy_v7 <- data %>%
    filter(visit == 'V7')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v7 <- pregnancy_v7 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v7)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
## V8 ##########################

pregnancy_v8 <- data %>%
    filter(visit == 'V8')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v8 <- pregnancy_v8 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v8)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA

  ## V9 ##########################

pregnancy_v9 <- data %>%
    filter(visit == 'V9')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v9 <- pregnancy_v9 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v9)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  
  ## V10 ##########################

pregnancy_v10 <- data %>%
    filter(visit == 'V10')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v10 <- pregnancy_v10 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v10)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA
  
  ## V11 ##########################

pregnancy_v11 <- data %>%
    filter(visit == 'V11')
  
  # create a table that shows how many people are follow up and enrolment in V2
  # make a table of reasons people are eos
  table_visit_type_v11 <- pregnancy_v11 %>%
    group_by(enrolment) %>%
    summarise('Number of people' = n()) %>%
    arrange(enrolment) %>%
    rename('Visit type' = enrolment) %>%
    add_row('Visit type' = 'total', 'Number of people' = sum(.$'Number of people')) %>%
    mutate('Percent' = (as.numeric(`Number of people`)) / as.numeric(nrow(pregnancy_v11)) * 100) %>%
    mutate('Percent' = round(`Percent`, 2)) %>%
    mutate('Percent' = paste0(`Percent`, '%')) # Replace zero values with NA




```

```{r eos_reason}
# create a table of the reasons a woman is eos

## V2 ####################

  pfu_eos_v2 <- data %>%
    filter(visit == 'V2',
           pregnancy_status == 'eos')

  eos_reasons_v2 <- pfu_eos_v2 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v2)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
  
## V3 ####################

  pfu_eos_v3 <- data %>%
    filter(visit == 'V3',
           pregnancy_status == 'eos')

  eos_reasons_v3 <- pfu_eos_v3 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v3)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
    
  
  
## V4 ####################

  pfu_eos_v4 <- data %>%
    filter(visit == 'V4',
           pregnancy_status == 'eos')

  eos_reasons_v4 <- pfu_eos_v4 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v4)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
  
## V5 ####################

  pfu_eos_v5 <- data %>%
    filter(visit == 'V5',
           pregnancy_status == 'eos')

  eos_reasons_v5 <- pfu_eos_v5 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v5)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
  
## V6 ####################

  pfu_eos_v6 <- data %>%
    filter(visit == 'V6',
           pregnancy_status == 'eos')

  eos_reasons_v6 <- pfu_eos_v6 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v6)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
  
## V7 ####################

  pfu_eos_v7 <- data %>%
    filter(visit == 'V7',
           pregnancy_status == 'eos')

  eos_reasons_v7 <- pfu_eos_v7 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v7)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
## V8 ####################

  pfu_eos_v8 <- data %>%
    filter(visit == 'V8',
           pregnancy_status == 'eos')

  eos_reasons_v8 <- pfu_eos_v8 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v8)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA

## V9 ####################

  pfu_eos_v9 <- data %>%
    filter(visit == 'V9',
           pregnancy_status == 'eos')

  eos_reasons_v9 <- pfu_eos_v9 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v9)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA

  
## V10 ####################

  pfu_eos_v10 <- data %>%
    filter(visit == 'V10',
           pregnancy_status == 'eos')

  eos_reasons_v10 <- pfu_eos_v10 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v10)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA
  
  
  ## V11 ####################

  pfu_eos_v11 <- data %>%
    filter(visit == 'V11',
           pregnancy_status == 'eos')

  eos_reasons_v11 <- pfu_eos_v11 %>%
      group_by(pregnancy_status_reason) %>%
      summarise('Number of eos people' = n()) %>%
      arrange(pregnancy_status_reason) %>%
      rename('Reason for eos' = pregnancy_status_reason) %>%
      add_row('Reason for eos' = 'total visited', 'Number of eos people' = sum(.$'Number of eos people')) %>%
      mutate('Percent complete' = (as.numeric(`Number of eos people`)) / as.numeric(nrow(pfu_eos_v11)) * 100) %>%
      mutate('Percent complete' = round(`Percent complete`, 2)) %>%
      mutate('Percent complete' = paste0(`Percent complete`, '%')) # Replace zero values with NA


```

# PFU targets
```{r target_show}
reactable(target_table, columns = list(), pagination = FALSE)
```
_Note: these targets are currently being edited by Nika and Aryton and the individual and household target may be slightly off._



# V11 Numbers
```{r v11_table_status}
reactable(pfu_totals_v11, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v11$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v11$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}

```

## Visit type
```{r v11_visit_type}
reactable(table_visit_type_v11, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v11_table_eos_reason}
reactable(eos_reasons_v11, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v10$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```




# V10 Numbers
```{r v10_table_status}
reactable(pfu_totals_v10, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v10$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v10$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}

```

## Visit type
```{r v10_visit_type}
reactable(table_visit_type_v10, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v10_table_eos_reason}
reactable(eos_reasons_v10, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v10$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```




# V9 Numbers
```{r v9_table_status}
reactable(pfu_totals_v9, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v9$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v9$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}

```

## Visit type
```{r v9_visit_type}
reactable(table_visit_type_v9, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v9_table_eos_reason}
reactable(eos_reasons_v9, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v9$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```




# V8 Numbers
```{r v8_table_status}
reactable(pfu_totals_v8, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v8$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v8$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}

```

## Visit type
```{r v8_visit_type}
reactable(table_visit_type_v8, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v8_table_eos_reason}
reactable(eos_reasons_v8, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v8$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```



# V7 Numbers
```{r v7_table_status}
reactable(pfu_totals_v7, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v7$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v7$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}

```

## Visit type
```{r v7_visit_type}
reactable(table_visit_type_v7, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v7_table_eos_reason}
reactable(eos_reasons_v7, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v7$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```


# V6 Numbers
```{r v6_table_status}
reactable(pfu_totals_v6, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v6$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v6$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}
```

## Visit type
```{r v6_visit_type}
reactable(table_visit_type_v6, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v6_table_eos_reason}
reactable(eos_reasons_v6, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v6$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```



# V5 Numbers
```{r v5_table_status}
reactable(pfu_totals_v5, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v5$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v5$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}
```

## Visit type
```{r v5_visit_type}
reactable(table_visit_type_v5, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v5_table_eos_reason}
reactable(eos_reasons_v5, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v5$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```


# V4 Numbers
```{r v4_table_status}
reactable(pfu_totals_v4, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v4$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v4$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}
```

## Visit type
```{r v4_visit_type}
reactable(table_visit_type_v4, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v4_table_eos_reason}
reactable(eos_reasons_v4, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v4$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```


# V3 Numbers
```{r v3_table_status}
reactable(pfu_totals_v3, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v3$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v3$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}
```

## Visit type
```{r v3_visit_type}
reactable(table_visit_type_v3, columns = list(
  `Percent` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page
```

## eos reason
```{r v3_table_eos_reason}
reactable(eos_reasons_v3, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v3$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```

# V2 Numbers
```{r v2_table_status}
reactable(pfu_totals_v2, columns = list(
  `Percent complete` = colDef(align = "right")
))

# make a note of the real total number of people visited without repeats
if (any(duplicated(pfu_totals_v2$extid))) {
  cat("Note: Excluding the duplicates, the real total number of people visited is", length(unique(pfu_totals_v2$extid)), "\n.")
} else {
  cat("Note: There are no duplicates based on extid in the data.")
}
```
Note: In V2 we identified extid '14024-02' to have been pregnant but not have taken drug, so they were removed from PFU. Also, 08016-02 was incorrectly enrolled into PFU because she did not take drug, however because she had an SAE her PFU submission has to be kept (therefore do not use 08016-02 in PFU analyses).

## eos reason
```{r v2_table_eos_reason}
reactable(eos_reasons_v2, columns = list(
  `Percent complete` = colDef(align = 'right')
), pagination = FALSE) #pagination makes the entire table show on one page

# write which reasons do not appear in the table
# Specify the names you want to check for
names_to_check <- c('died',
                    'migrated',
                    'not wish to continue',
                    'no longer pregnant - baby born alive',
                    'no longer pregnant - miscarriage',
                    'no longer pregnant - abortion (self-induced)',
                    'no longer pregnant - baby was born dead',
                    'no longer pregnant - prefer not to answer')

# Initialize a vector to store names not found
not_found_names <- character(0)

# Check each name
for (name in names_to_check) {
  if (!name %in% eos_reasons_v2$reason) {
    not_found_names <- c(not_found_names, name)
  }
}

# Generate a message based on the results (only if names are not found)
if (length(not_found_names) > 0) {
  cat("The following reasons are not shown: ", paste0(not_found_names, collapse = " / "))
}
```

# PFU extid explorer
```{r pfu-explorer}
element_id <- 'extid-explorerer'

data_readable <- reactable(data_investigation, columns = list(), 
                                              highlight = TRUE,
                                              resizable = TRUE,
                                              bordered = TRUE,
                                              striped = TRUE,
                                              filterable=TRUE,
                                              elementId = element_id
                                              )

wrap_download(
  data_readable, 
  element_id,
  'pfu_extid_explorer.csv')
```
